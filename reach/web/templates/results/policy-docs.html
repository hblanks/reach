{% extends 'base.html' %}

{% set status = es_status %}
{% if es_response is mapping %}
    {% set status = status and (es_response.hits.total.value > 0) %}
{% endif %}{% block header %}

<header class="navbar">
  <section class="navbar-section">
        <a href="/" class="navbar-brand"><h2>Reach</h2></a>
  </section>
  <section class="navbar-section hide-md" id="navbar-links">
    <a href="/about" class="a-light">About Reach</a>
    <a href="/how-it-works" class="a-light">How Reach works</a>
    <a href="/search/citations" class="a-light">Discover citations</a>
    <a href="/search/policy-docs" class="a-light active">Browse policy documents</a>
  </section>
</header>

{% endblock %}

{% block main %}

<section id="breadcrumbs">
    <div class="breadcrumb-box">
        <ul class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Home</a></li>
            <li class="breadcrumb-item">Browse policy documents</li>
        </ul>
    </div>
</section>

<section id="policy-docs-results" class="results-box">
    <div class="container">
        <hr class="hs">
        <div class="columns">
            {% if status %}
                <div class="column col-12 col-md-12">
                    <h1>Research Publication and policy citations results for "{{ term }}"</h1>
                </div>
            {% else %}
                <div class="column col-12 col-md-12">
                    <h1>No results for "{{ term }}" in policy documents</h1>
                </div>
            {% endif %}
            <div class="column col-12 col-md-12">
                <p>Search by Reseach Publication, journal, author or year of publication</p>
            </div>
            <div class="column col-6 col-md-12">
                <form action="/search/citations">
                    <div class="input-group">
                      <input type="text" class="form-input input-xl" placeholder="Search" name="term" id="search-term" value="{{ term }}">
                      <button type="submit" class="btn btn-primary input-group-btn input-btn-xl">Browse policy documents <span class="icn icn-search"></span></button>
                    </div>
                </form>
                <div class="search-tips">
                    <a href="#">Advanced search tips</a>
                    <div class="popover popover-bottom">
                      <span class="btn help">?</span>
                      <div class="popover-container">
                        <div class="card">
                          {{ uparrow() }}
                          <div class="card-body">
                            Wellcome Reach regularly loads the PDFs of WHO, MSF, UNICEF, NICE, and other
                            organizations. Click this button to search the citations in those documents.
                          </div>
                        </div>
                      </div>
                    </div>
                </div>
            </div>
            {% if status %}
            <div class="column col-6 col-md-12 text-right">
                <a class="btn btn-primary btn-xl" href="#" >Download results as .csv <span class="icn icn-download"></span></a>
            </div>
            {% else %}
            <div class="column col-6 hide-md"></div>
            {% endif %}
        </div>
        {% if not status %}
            <hr class="fs">
            <div class="columns">
                <div class="column col-6 col-md-12">
                    <p class="bold">
                        Search tips
                    </p>
                    <ul>
                        <li>Check your spelling</li>
                        <li>Broaden your search by using fewer or more general terms</li>
                        <li>Try searching by topic, award or area of work</li>
                    </ul>
                    <p class="bold">
                        Still can’t find what you are looking for?
                    </p>
                    <p>Help us to improve Reach and <a href="mailto:engineering.datalabs@wellcome.ac.uk">send us your feedback</a></p>
                </div>
                <div class="column col-6 hide-md"></div>
            </div>
            <hr class="fs">
            <hr class="fs">
            <div class="columns">
                <div class="column col-6 col-md-12">
                    <div class="feedback-box">
                        <p class="bold">Can't find what you're looking for?</p>
                        <p>Can’t find what you’re looking for? We are working to continually improve Reach, if it is not working as you expect, there is an error or you have a suggestion, please <a href="mailto:engineering.datalabs@wellcome.ac.uk">send us your feedback</a></p>
                    </div>
                </div>
                <div class="column col-6 hide-md"></div>
            </div>
            <hr class="fs">
        {% endif %}
        </div>
    {% if status %}
        <div class="container">
            <div class="columns">
                <div class="column col-6 col-md-12">
                    {{ (page - 1) * size + 1 }} - {{ [(page - 1) * size + size, es_response.hits.total.value] | min }} of {{ es_response.hits.total.value }} results
                </div>
                <div class="column col-6 col-md-12">
                    <div class="pagination-box float-right">

                        <ul class="pagination">
                            {% if page > 1 %}
                                   <li class="page-item">
                                    <a href="/search/policy-docs?term={{ term }}&page={{ page - 1 }}">Prev</a>
                                </li>
                            {% else %}
                                <li class="page-item disabled">
                                    <a href="#" tabindex="-1">Prev</a>
                                </li>
                            {% endif %}
                            {% for n_page in pages %}
                                <li class="page-item {% if n_page == page %}active{% endif %}">
                                    <a href="/search/policy-docs?term={{ term }}&page={{ n_page }}">{{ n_page }}</a>
                                </li>
                            {% endfor %}
                            {% if page < pages|length %}
                                   <li class="page-item">
                                    <a href="/search/policy-docs?term={{ term }}&page={{ page + 1 }}">Next</a>
                                </li>
                            {% else %}
                                <li class="page-item disabled">
                                    <a href="#" tabindex="-1">Next</a>
                                </li>
                            {% endif %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="results">
            <div class="container">
                <table class="table table-light table-hover">
                    <thead>
                        <tr>
                            <th>Policy Document</th>
                            <th>Organisation</th>
                            <th>Author(s)</th>
                            <th>Year of publication</th>
                        </tr>
                    </thead>
                     <tbody>
                        {% for hit in es_response.hits.hits %}
                            <tr>
                                <td>
                                    {% if hit._source.doc.text %}
                                        {{ hit._source.doc.text | truncate(60) }}
                                    {% else %}
                                        No title
                                    {% endif %}
                                    </td>
                                <td>{{ hit._source.doc.organisation }}</td>
                                <td>{{ hit._source.doc.authors }}</td>
                                <td>{{ hit._source.doc.year }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <hr class="fs">
        <div class="columns">
            <div class="column col-6 col-md-12">
                <div class="feedback-box">
                    <p class="bold">About these results</p>
                    <p>To learn more about how reach works and how it has generated these results, go to the <a href="/how-it-works">How Reach works</a> page</p>
                </div>
            </div>
            <div class="column col-6 col-md-12">
                <div class="feedback-box">
                    <p class="bold">Can't find what you're looking for?</p>
                    <p>Can’t find what you’re looking for? We are working to continually improve Reach, if it is not working as you expect, there is an error or you have a suggestion, please <a href="mailto:engineering.datalabs@wellcome.ac.uk">send us your feedback</a></p>
                </div>
            </div>
        </div>
        <hr class="fs">
    {% endif %}
</section>
{% endblock %}
